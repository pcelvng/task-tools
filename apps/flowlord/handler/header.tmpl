{{define "header"}}
<div class="nav-header">
    <div class="nav-container">
        <div class="nav-controls">
            <div class="date-picker-container">
                <label for="datePicker" class="date-picker-label">Date:</label>
                <input type="date" id="datePicker" class="date-picker" value="{{.DateValue}}">
                <button id="todayBtn" class="btn btn-sm btn-outline">Today</button>
            </div>
            {{if .ShowRefresh}}
            <button class="refresh-btn" onclick="location.reload()">Refresh</button>
            {{end}}
        </div>
        <div class="nav-brand">
            <h1>{{if .PageTitle}}{{.PageTitle}}{{else}}Flowlord Dashboard{{end}}</h1>
        </div>
        <nav class="nav-menu">
            {{if .isLocal}}
            <a href="./alert_preview.html{{if .DateValue}}?date={{.DateValue}}{{end}}" class="nav-link {{if eq .CurrentPage "alert"}}active{{end}}">
                <span class="nav-icon">ğŸš¨</span>
                Alerts
            </a>
            <a href="./files_preview.html{{if .DateValue}}?date={{.DateValue}}{{end}}" class="nav-link {{if eq .CurrentPage "files"}}active{{end}}">
                <span class="nav-icon">ğŸ“</span>
                Files
            </a>
            <a href="./task_preview.html{{if .DateValue}}?date={{.DateValue}}{{end}}" class="nav-link {{if eq .CurrentPage "task"}}active{{end}}">
                <span class="nav-icon">ğŸ“Š</span>
                Tasks
            </a>
            <a href="./workflow_preview.html" class="nav-link {{if eq .CurrentPage "workflow"}}active{{end}}">
                <span class="nav-icon">ğŸŒ³</span>
                Workflow
            </a>
            <a href="./about_preview.html" class="nav-link {{if eq .CurrentPage "about"}}active{{end}}">
                <span class="nav-icon">â„¹ï¸</span>
                About
            </a>
            {{else}}
            <a href="/web/alert{{if .DateValue}}?date={{.DateValue}}{{end}}" class="nav-link {{if eq .CurrentPage "alert"}}active{{end}}">
                <span class="nav-icon">ğŸš¨</span>
                Alerts
            </a>
            <a href="/web/files{{if .DateValue}}?date={{.DateValue}}{{end}}" class="nav-link {{if eq .CurrentPage "files"}}active{{end}}">
                <span class="nav-icon">ğŸ“</span>
                Files
            </a>
            <a href="/web/task{{if .DateValue}}?date={{.DateValue}}{{end}}" class="nav-link {{if eq .CurrentPage "task"}}active{{end}}">
                <span class="nav-icon">ğŸ“Š</span>
                Tasks
            </a>
            <a href="/web/workflow" class="nav-link {{if eq .CurrentPage "workflow"}}active{{end}}">
                <span class="nav-icon">ğŸŒ³</span>
                Workflow
            </a>
            <a href="/web/about" class="nav-link {{if eq .CurrentPage "about"}}active{{end}}">
                <span class="nav-icon">â„¹ï¸</span>
                About
            </a>
            {{end}}
        </nav>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const datePicker = document.getElementById('datePicker');
    const todayBtn = document.getElementById('todayBtn');
    
    // Set today's date as default if no date is provided
    if (!datePicker.value) {
        const today = new Date().toISOString().split('T')[0];
        datePicker.value = today;
    }
    
    // Handle date change
    datePicker.addEventListener('change', function() {
        const selectedDate = this.value;
        if (selectedDate) {
            // Get current page and preserve other query parameters
            const currentUrl = new URL(window.location);
            const currentPage = currentUrl.pathname;
            
            // Build new URL with date parameter
            const newUrl = new URL(currentPage, window.location.origin);
            newUrl.searchParams.set('date', selectedDate);
            
            // Preserve other query parameters (type, job, result, etc.)
            const otherParams = ['type', 'job', 'result', 'sort', 'direction'];
            otherParams.forEach(param => {
                if (currentUrl.searchParams.has(param)) {
                    newUrl.searchParams.set(param, currentUrl.searchParams.get(param));
                }
            });
            
            // Navigate to new URL
            window.location.href = newUrl.toString();
        }
    });
    
    // Handle today button
    todayBtn.addEventListener('click', function() {
        const today = new Date().toISOString().split('T')[0];
        datePicker.value = today;
        
        // Trigger change event
        datePicker.dispatchEvent(new Event('change'));
    });
});
</script>
{{end}}
